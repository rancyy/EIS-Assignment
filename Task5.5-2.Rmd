---
title: "Task5.5-Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    navbar:
     - { title: "Link to testA web", href: "https://www.rancyreneis.tk/" }
     - { title: "Link to testB web", href: "https://rancyren.wixsite.com/website-1" }
---
The latest analysis was conducted on May 22th at 16:22, after 40 subjects entered the experiment(20 in test A and 20 in test B), 9 interim analysis pending (total subjects=180 for power=95%).
---
Estimated time for next analysis: May 23th at 17:22
Estimated time for completion:8 days

---
```{r setup, include=FALSE}
library(flexdashboard)
```
Visualizations {data-icon="fa-signal"}
===================================== 
Column 
-------------------------------------
### The latest analysis

```{r}
finf<-file.info("Experiment data-TestA&B v2.csv")
mtime<-finf$mtime
computeArticles = function(...) return(mtime)
articles = computeArticles()
valueBox(articles, icon = "fa-pencil")
```

### Comments per Day

```{r}
computeComments = function(...) return(126)
comments = computeComments()
valueBox(comments, icon = "fa-comments")
```

### Spam per Day

```{r}
computeSpam = function(...) return(15)
spam = computeSpam()
valueBox(
  spam, icon = "fa-trash",
  color = ifelse(spam > 10, "warning", "primary")
)
```
    
A narrow column {data-width=450}
-----------------------------------------------------------------------

### Chart A-Descriptive statistics
```{r}
library(psych) # describeBy
library(readxl)
library(nlme)
library(ggplot2)
library(lsr)
library(emmeans)
```


```{r}
d <- as.data.frame(read_xls("Experiment data-TestA&B v2.xls"))
Run<-as.factor(d$Run)
Time <-as.numeric(d$Time)
describeBy(Time, Run)
```

### Chart B-Descriptive statistics.2
```{r}
boxplot(Time ~ Run)
```

A narrow column {data-height=100}
-----------------------------------------------------------------------

### Chart C-Z-test

```{r}
d <- as.data.frame(read_xls("Experiment data-TestA&B v2.xls"))
Run<-as.factor(d$Run)
Time <-as.numeric(d$Time)
sd_A <- sd(d[d$Run == "A",]$Time)
sd_B <- sd(d[d$Run == "B",]$Time)
X_A <- mean(d[d$Run == "A",]$Time)
X_B <- mean(d[d$Run == "B",]$Time)
S2_A <- sd_A^2
S2_B <- sd_B^2
n_A <- length(d[d$Run == "A",]$Time)
n_B <- length(d[d$Run == "B",]$Time)

X_diff = X_B - X_A
(Z_diff = X_diff / sqrt(S2_A/n_A + S2_B/n_B))
```
Tables {data-icon="fa-table"}
=====================================     

### Chart C-Effect size
```{r}
library(effsize) # cohen.d

(cohen.d(Time ~ Test, hedges.correction=TRUE, data = d))
```


Column {data-width=350}
-----------------------------------------------------------------------
### Chart D-Confidence intervals


```{r}
d <- as.data.frame(read_excel("Experiment data-TestA&B.xls"))
d$Test<-as.factor(d$Test)
Time <-d$Time

X_A <- mean(d[d$Test == "A",]$Time)
X_B <- mean(d[d$Test == "B",]$Time)
S2_A <- var(d[d$Test == "A",]$Time)
S2_B <- var(d[d$Test == "B",]$Time)
n_A <- length(d[d$Test == "A",]$Time)
n_B <- length(d[d$Test == "B",]$Time)

X_diff = X_B - X_A
SE_diff = sqrt(S2_A/n_A + S2_B/n_B)

# Notice that we are adjusting in this case using a normal distribution, not the t distribution
z_alpha_half <- qnorm(1-0.05/2)

(cinterval <- c(X_diff-SE_diff*z_alpha_half, X_diff+SE_diff*z_alpha_half))

# Please notice that the t.test returns the confidence interval automatically
t.test(Time ~ Test, data=d, alternative="two.sided", conf.level = 0.95, var.equal=TRUE)
```
